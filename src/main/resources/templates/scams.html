<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Safety Intelligence - RoamSafe</title>

  <!-- Custom Theme -->
  <link rel="stylesheet" th:href="@{/css/modern-theme.css}" />
  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

  <!-- LEFT SIDEBAR NAV -->
  <div class="sidebar-left">
    <div class="sidebar-logo">R</div>
    <a href="/" class="nav-item" title="Home"><i data-lucide="map"></i></a>
    <a href="/scams" class="nav-item active" title="Destinations"><i data-lucide="compass"></i></a>
    <a href="/submit" class="nav-item" title="Report Scam"><i data-lucide="file-plus-2"></i></a>
    <a href="#" class="nav-item" title="About"><i data-lucide="info"></i></a>
    <div class="spacer"></div>
    <a href="/login" class="nav-item" title="Sign In"><i data-lucide="log-in"></i></a>
  </div>

  <!-- MAIN CONTENT AREA -->
  <div class="scams-layout">

    <!-- HEADER -->
    <header
      style="margin-bottom: 2rem; padding: 1rem 0; display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h1
          style="font-size: 2.5rem; color: var(--text-primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 12px;">
          <i data-lucide="shield-alert" style="color: var(--primary-accent);"></i>
          <span th:text="${selectedCity != null ? selectedCity : 'Global'}">City</span>
          <span style="font-weight: 300; opacity: 0.6;">Intelligence</span>
        </h1>
        <p style="color: var(--text-secondary); font-size: 1.1rem;">Live risk reports and safety analysis.</p>
      </div>

      <!-- SEARCH PILL -->
      <form action="/scams" method="get">
        <div
          style="background: white; padding: 8px 16px; border-radius: 50px; display: flex; align-items: center; box-shadow: var(--shadow-soft); border: 1px solid var(--border-color);">
          <i data-lucide="search" style="color: var(--text-secondary); width: 18px;"></i>
          <input type="text" name="city" placeholder="Analyze another city..." th:value="${selectedCity}"
            style="border: none; outline: none; padding: 8px; font-size: 1rem; color: var(--text-primary); background: transparent; width: 200px;">
        </div>
      </form>
    </header>

    <!-- DASHBOARD VIEW (When no city selected) -->
    <div th:if="${selectedCity == null}">

      <!-- TOP CITIES ROW -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="font-size: 1.5rem; color: var(--text-primary);"><i data-lucide="trending-up"
            style="width: 20px; display: inline-block; margin-right: 8px;"></i> Trending Hotspots</h2>
      </div>

      <div
        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; margin-bottom: 3rem;">
        <a th:each="cityData : ${topCities}" th:href="@{/scams(city=${cityData[0]})}" class="glass-panel"
          style="padding: 20px; text-decoration: none; color: inherit; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; border: 1px solid transparent;">
          <span th:text="${cityData[0]}" style="font-weight: 700; font-size: 1.1rem;">City Name</span>
          <span th:text="${cityData[1]}"
            style="background: #ffebee; color: #d32f2f; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 700;">12</span>
        </a>
      </div>

      <!-- RECENT ALERTS -->
      <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--text-primary);"><i data-lucide="activity"
          style="width: 20px; display: inline-block; margin-right: 8px;"></i> Recent Global Alerts</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px;">
        <div th:each="scam : ${recentReports}" class="glass-panel"
          style="padding: 24px; position: relative; overflow: hidden; display: flex; flex-direction: column;">
          <!-- City Badge -->
          <div
            style="position: absolute; top: 0; right: 0; background: var(--primary-accent); color: white; padding: 6px 16px; border-bottom-left-radius: 16px; font-size: 0.75rem; font-weight: 800; letter-spacing: 0.05em; text-transform: uppercase;"
            th:text="${scam.city}">CITY</div>

          <div
            style="margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-muted);">
            <i data-lucide="clock" style="width: 14px;"></i> Just now
          </div>

          <h3 th:text="${scam.name}"
            style="font-size: 1.25rem; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">Scam Name</h3>

          <p th:text="${#strings.abbreviate(scam.description, 120)}"
            style="color: #666; font-size: 0.95rem; line-height: 1.6; margin-bottom: 16px; flex-grow: 1;"></p>

          <div style="border-top: 1px solid rgba(0,0,0,0.05); padding-top: 16px; margin-top: auto;">
            <a th:href="@{/scams(city=${scam.city})}"
              style="color: var(--primary-accent); font-weight: 600; text-decoration: none; font-size: 0.9rem; display: flex; align-items: center; gap: 6px;">
              View Report <i data-lucide="arrow-right" style="width: 14px;"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- CITY REPORTS GRID (When city selected) -->
    <div th:if="${selectedCity != null}">

      <!-- FILTERS -->
      <div style="margin-bottom: 2rem; display: flex; gap: 1rem;">
        <button class="glass-panel"
          style="padding: 10px 20px; cursor: pointer; color: var(--text-primary); font-weight: 600; display: flex; align-items: center; gap: 8px;">
          <i data-lucide="filter" style="width: 16px;"></i> All Reports
        </button>
        <button class="glass-panel"
          style="padding: 10px 20px; cursor: pointer; color: #d32f2f; background: #ffebee; border-color: #ffcdd2;">
          <i data-lucide="alert-triangle" style="width: 16px; display: inline-block; vertical-align: text-bottom;"></i>
          High Risk
        </button>
        <button class="glass-panel"
          style="padding: 10px 20px; cursor: pointer; color: #f57f17; background: #fff3e0; border-color: #ffe0b2;">
          <i data-lucide="eye" style="width: 16px; display: inline-block; vertical-align: text-bottom;"></i> Caution
        </button>
      </div>

      <!-- REPORTS GRID -->
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px;">

        <div th:each="scam : ${scams}" class="glass-panel" style="padding: 24px; position: relative; overflow: hidden;">
          <!-- Decorative Icon Background -->
          <i data-lucide="alert-circle"
            style="position: absolute; right: -20px; top: -20px; width: 120px; height: 120px; opacity: 0.05; color: var(--primary-accent);"></i>

          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
            <span th:if="${scam.safetyZone != null}" th:text="${scam.safetyZone}"
              style="font-size: 0.75rem; font-weight: 800; letter-spacing: 0.05em; padding: 4px 12px; border-radius: 20px; text-transform: uppercase;"
              th:styleappend="${scam.safetyZone.name() == 'RED' || scam.safetyZone.name() == 'HIGH_RISK' ? 'background:#ffebee; color:#d32f2f;' : (scam.safetyZone.name() == 'YELLOW' || scam.safetyZone.name() == 'CAUTION' ? 'background:#fff3e0; color:#f57f17;' : 'background:#e8f5e9; color:#2e7d32;')}">
              ZONE
            </span>
            <span style="font-size: 0.85rem; color: var(--text-muted); display: flex; align-items: center; gap: 4px;">
              <i data-lucide="calendar" style="width: 14px;"></i> Just now
            </span>
          </div>

          <h3 th:text="${scam.name}"
            style="font-size: 1.25rem; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">Scam Name</h3>

          <div
            style="display: flex; align-items: center; gap: 6px; margin-bottom: 16px; color: var(--text-secondary); font-size: 0.9rem;">
            <i data-lucide="map-pin" style="width: 16px; color: var(--primary-accent);"></i>
            <span th:text="${scam.neighborhood}">Location</span>
          </div>

          <p th:text="${scam.description}"
            style="color: #666; font-size: 0.95rem; line-height: 1.6; margin-bottom: 20px;">
            Description...
          </p>

          <!-- Tip Box -->
          <div th:if="${scam.preventionTips != null}"
            style="background: rgba(255, 255, 255, 0.6); border-radius: 12px; padding: 12px; border-left: 4px solid var(--primary-accent);">
            <div
              style="display: flex; align-items: center; gap: 6px; color: var(--primary-accent); font-weight: 700; font-size: 0.8rem; margin-bottom: 4px;">
              <i data-lucide="lightbulb" style="width: 14px;"></i> PRO TIP
            </div>
            <div th:text="${scam.preventionTips}" style="font-size: 0.9rem; color: var(--text-primary);">Tip...</div>
          </div>
        </div>

      </div>

      <!-- Empty State -->
      <div th:if="${scams != null && scams.empty}" style="text-align: center; padding: 4rem;">
        <div class="glass-panel" style="display: inline-block; padding: 3rem;">
          <i data-lucide="check-circle" style="width: 48px; height: 48px; color: #2e7d32; margin-bottom: 1rem;"></i>
          <h3 style="margin-bottom: 12px;">No reports found for this location.</h3>
          <p style="color: var(--text-secondary);">It seems safe for now, or we need more data.</p>
          <a href="/submit"
            style="display: inline-block; margin-top: 20px; background: var(--primary-accent); color: white; padding: 10px 24px; border-radius: 50px; text-decoration: none; font-weight: 600;">Submit
            a Report</a>
        </div>
      </div>

    </div> <!-- End selectedCity check -->

  </div>

  <script>
    lucide.createIcons();
  </script>

</body>

</html>